"undefined"!=typeof Spinner&&($.fn.spin=function(a){return this.each(function(){var b=$(this),c=b.data();c.spinner&&(c.spinner.stop(),delete c.spinner),a!==!1&&(c.spinner=new Spinner($.extend({color:b.css("color")},a)).spin(this))}),this}),!function($){"use strict";function processAjax($this,method,url,data,successCallback){$.ajax({url:url,type:method,data:data,success:function(data,textStatus){processData(data,$this),successCallback&&eval(successCallback+".call(this,data,textStatus)")},beforeSend:function(){spin($this,!0)},complete:function(){spin($this,!1)},error:function(a){processError($this,a)}})}function spin(a,b){if($.fn.spin!==void 0){var c=a.attr("data-replace"),d=a.attr("data-append"),e=a.attr("data-refresh"),f=1==b?{radius:30,length:0,width:10,color:"#C40000",trail:40}:!1;c&&$(c).spin(f),d&&$(d).spin(f),e&&$(e).spin(f)}}function processData(data,$el){if(data.location)window.location.href=data.location;else{var replace_selector=$el.attr("data-replace"),append_selector=$el.attr("data-append"),refresh_selector=$el.attr("data-refresh");replace_selector&&$(replace_selector).html(data.html).bootAjax(),append_selector&&$(append_selector).append(data.html).bootAjax(),refresh_selector&&$.each($(refresh_selector),function(index,value){var url=$(value).data("refresh-url"),data=$(value).attr("data-data"),method=$(value).attr("method"),successCallback=$(value).attr("data-success-callback");method||(method="GET"),$.ajax({url:url,type:method,data:data,success:function(data,textStatus){$(value).html(data.html).bootAjax(),successCallback&&eval(successCallback+".call(this,data,textStatus)")},error:function(a){$(value).html(buildErrorMsg(a))}})})}}function processError(a,b){var c=buildErrorMsg(b),d=a.attr("data-replace"),e=a.attr("data-append");d&&$(d).html(c),e&&$(e).append(c)}function buildErrorMsg(a){var b="";return b=404==a.status?"<strong>\u9519\u8bef\uff01</strong>HTTP 404-\u8bf7\u6c42\u7684\u9875\u9762\u4e0d\u5b58\u5728\u6216\u94fe\u63a5\u9519\u8bef":0==a.status?"<strong>\u9519\u8bef\uff01</strong> \u670d\u52a1\u65e0\u6548\uff0c\u8bf7\u68c0\u67e5\u670d\u52a1\u5668\u72b6\u6001":500==a.status?"<strong>\u9519\u8bef\uff01</strong>HTTP 500\u5185\u90e8\u670d\u52a1\u5668\u9519\u8bef":"\u9519\u8bef\u4ee3\u53f7:"+a.status+" \u9519\u8bef\u4fe1\u606f\uff1a"+a.statusText,'<div class="alert alert-error">'+b+"</div>"}var Ajax=function(){};Ajax.prototype.click=function(a){var b=$(this),c=b.attr("href"),d=b.attr("data-data"),e=b.attr("data-method"),f=b.attr("data-success-callback");e||(e="get"),a.preventDefault(),processAjax(b,e,c,d,f)},Ajax.prototype.submit=function(a){var b=$(this),c=b.attr("action"),d=b.serialize(),e=b.attr("method"),f=b.attr("data-success-callback");b.find("input[type=submit],button[type=submit]").attr("disabled","disabled"),a.preventDefault(),processAjax(b,e,c,d,f)},Ajax.prototype.cancel=function(a){var b=$(this),c=b.attr("data-cancel-closest");a.preventDefault(),b.closest(c).remove()},$.fn.bootAjax=function(){return this.each(function(){var a=$(this);a.find("a.ajax").bind("click",Ajax.prototype.click),a.find("form.ajax").bind("submit",Ajax.prototype.submit),a.find("a[data-cancel-closest]").bind("click",Ajax.prototype.cancel)})},$(function(){$("body").bootAjax()})}(window.jQuery);